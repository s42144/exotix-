<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1" />
  <title>Exotix Trade | Admin Panel</title>
  <link rel="icon" href="https://github.com/s42144/exotix-/blob/ce4cd9399ff673963389c393946138254a0edbe5/USDT-Ton-Wallet.png?raw=true" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Firebase v9 Modular -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root{
      --primary-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      --secondary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
      --dark-bg: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 50%, #2d2d2d 100%);
      --card-bg: rgba(255,255,255,0.05);
      --card-border: rgba(255,255,255,0.1);
      --text-primary: #ffffff; 
      --text-secondary: #a0a0a0;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
      --shadow-md: 0 4px 16px rgba(0,0,0,0.3); 
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
    }
    html,body{width:100%;height:100%;font-family:'Inter',system-ui,Segoe UI,sans-serif;background:var(--dark-bg);color:var(--text-primary);overflow-x:hidden}
    .admin-container{display:flex;min-height:100vh}
    .sidebar{width:250px;background:rgba(12,12,12,0.95);backdrop-filter:blur(20px);border-right:1px solid var(--card-border);padding:20px 0;overflow-y:auto}
    .sidebar-header{text-align:center;margin-bottom:30px;padding:0 20px}
    .sidebar-logo{width:80px;height:80px;border-radius:50%;margin-bottom:10px}
    .sidebar-title{font-size:20px;font-weight:800;background:var(--success-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .sidebar-subtitle{font-size:12px;color:var(--text-secondary)}
    .nav-item{display:flex;align-items:center;padding:12px 20px;color:var(--text-secondary);text-decoration:none;transition:all 0.2s;cursor:pointer}
    .nav-item:hover{background:rgba(255,255,255,0.05);color:var(--text-primary)}
    .nav-item.active{background:var(--card-bg);color:var(--accent-blue);border-left:3px solid var(--accent-blue)}
    .nav-icon{width:20px;height:20px;margin-right:12px}
    .main-content{flex:1;padding:20px;overflow-y:auto}
    .content-header{margin-bottom:30px}
    .content-title{font-size:28px;font-weight:800;margin-bottom:8px}
    .content-subtitle{font-size:14px;color:var(--text-secondary)}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
    .stat-card{background:var(--card-bg);backdrop-filter:blur(20px);border-radius:16px;padding:20px;border:1px solid var(--card-border);box-shadow:var(--shadow-md)}
    .stat-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .stat-title{font-size:14px;color:var(--text-secondary);font-weight:600}
    .stat-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center}
    .stat-value{font-size:28px;font-weight:800;margin-bottom:4px}
    .stat-change{font-size:12px;font-weight:600}
    .stat-change.positive{color:var(--accent-green)}
    .stat-change.negative{color:var(--accent-red)}
    .card{background:var(--card-bg);backdrop-filter:blur(20px);border-radius:16px;padding:20px;border:1px solid var(--card-border);box-shadow:var(--shadow-md);margin-bottom:20px}
    .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .card-title{font-size:18px;font-weight:800}
    .btn{padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;color:#fff;cursor:pointer;transition:all 0.2s}
    .btn-primary{background:var(--primary-gradient)}
    .btn-success{background:var(--success-gradient)}
    .btn-danger{background:var(--danger-gradient)}
    .btn-warning{background:var(--warning-gradient)}
    .btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .form-group{margin-bottom:16px}
    .form-label{display:block;font-size:14px;font-weight:600;color:var(--text-secondary);margin-bottom:6px}
    .form-input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--card-border);background:rgba(255,255,255,0.06);color:#fff;outline:none}
    .form-input:focus{border-color:var(--accent-blue)}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:12px;text-align:left;border-bottom:1px solid var(--card-border)}
    .table th{font-weight:600;color:var(--text-secondary)}
    .table tr:hover{background:rgba(255,255,255,0.02)}
    .status-badge{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600}
    .status-pending{background:rgba(245,158,11,0.2);color:var(--accent-yellow)}
    .status-approved{background:rgba(16,185,129,0.2);color:var(--accent-green)}
    .status-rejected{background:rgba(239,68,68,0.2);color:var(--accent-red)}
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal-content{background:var(--dark-bg);border-radius:16px;padding:24px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;border:1px solid var(--card-border);box-shadow:var(--shadow-lg)}
    .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .modal-title{font-size:20px;font-weight:800}
    .modal-close{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.1);border:none;color:var(--text-primary);font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .modal-close:hover{background:rgba(255,255,255,0.2)}
    .tabs{display:flex;margin-bottom:20px;border-bottom:1px solid var(--card-border)}
    .tab{padding:12px 16px;font-weight:600;color:var(--text-secondary);cursor:pointer;border-bottom:2px solid transparent}
    .tab.active{color:var(--accent-blue);border-bottom-color:var(--accent-blue)}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .chart-container{height:300px;margin-bottom:20px}
    .pagination{display:flex;justify-content:center;gap:8px;margin-top:20px}
    .page-btn{padding:8px 12px;border-radius:6px;background:var(--card-bg);border:1px solid var(--card-border);color:var(--text-secondary);cursor:pointer}
    .page-btn.active{background:var(--accent-blue);color:#fff;border-color:var(--accent-blue)}
    .action-buttons{display:flex;gap:8px}
    .action-btn{padding:6px 10px;border-radius:6px;font-size:12px;font-weight:600;color:#fff;cursor:pointer}
    .action-btn.approve{background:var(--success-gradient)}
    .action-btn.reject{background:var(--danger-gradient)}
    .action-btn.edit{background:var(--primary-gradient)}
    .action-btn.ban{background:var(--warning-gradient)}
    .search-box{display:flex;margin-bottom:20px}
    .search-input{flex:1;padding:10px;border-radius:8px 0 0 8px;border:1px solid var(--card-border);background:rgba(255,255,255,0.06);color:#fff;outline:none;border-right:none}
    .search-btn{padding:10px 16px;border-radius:0 8px 8px 0;background:var(--primary-gradient);border:none;color:#fff;cursor:pointer}
    .user-details-modal .detail-row{display:flex;margin-bottom:12px}
    .user-details-modal .detail-label{width:120px;font-weight:600;color:var(--text-secondary)}
    .user-details-modal .detail-value{flex:1}
    .balance-input-group{display:flex;align-items:center}
    .balance-input-group .form-input{flex:1;margin-right:10px}
    .announcement-form .image-preview{width:100%;height:200px;border-radius:8px;border:1px solid var(--card-border);margin-bottom:16px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);background:rgba(255,255,255,0.02)}
    .announcement-form .image-preview img{max-width:100%;max-height:100%;object-fit:contain}
    .inline-button-form{display:flex;gap:10px;margin-bottom:16px}
    .inline-button-form .form-input{flex:1}
    .inline-button-list{margin-bottom:16px}
    .inline-button-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:rgba(255,255,255,0.05);border-radius:6px;margin-bottom:8px}
    .inline-button-item button{padding:4px 8px;border-radius:4px;background:var(--danger-gradient);border:none;color:#fff;font-size:12px;cursor:pointer}
    .task-form .image-preview{width:100%;height:150px;border-radius:8px;border:1px solid var(--card-border);margin-bottom:16px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);background:rgba(255,255,255,0.02)}
    .task-form .image-preview img{max-width:100%;max-height:100%;object-fit:contain}
    .code-list{margin-top:20px}
    .code-item{display:flex;align-items:center;justify-content:space-between;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:8px}
    .code-info{flex:1}
    .code-value{font-family:monospace;font-weight:700;margin-bottom:4px}
    .code-details{font-size:12px;color:var(--text-secondary)}
    .code-actions{display:flex;gap:8px}
    .copy-btn{padding:6px 10px;border-radius:6px;background:var(--primary-gradient);border:none;color:#fff;font-size:12px;cursor:pointer}
    .delete-btn{padding:6px 10px;border-radius:6px;background:var(--danger-gradient);border:none;color:#fff;font-size:12px;cursor:pointer}
    .promo-form .code-display{font-family:monospace;font-size:18px;font-weight:700;text-align:center;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:16px}
    .milestone-form{display:flex;flex-direction:column;gap:16px}
    .user-search{display:flex;margin-bottom:20px}
    .user-search-input{flex:1;padding:10px;border-radius:8px 0 0 8px;border:1px solid var(--card-border);background:rgba(255,255,255,0.06);color:#fff;outline:none;border-right:none}
    .user-search-btn{padding:10px 16px;border-radius:0 8px 8px 0;background:var(--primary-gradient);border:none;color:#fff;cursor:pointer}
    .user-result{padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:16px}
    .user-result-name{font-weight:700;margin-bottom:4px}
    .user-result-id{font-size:12px;color:var(--text-secondary);font-family:monospace}
    .balance-adjustment{display:flex;align-items:center;gap:10px;margin-top:16px}
    .balance-adjustment select{padding:10px;border-radius:8px;border:1px solid var(--card-border);background:rgba(255,255,255,0.06);color:#fff;outline:none}
    .notification{position:fixed;top:20px;right:20px;padding:12px 20px;border-radius:8px;font-weight:600;z-index:2000;animation:slideIn 0.3s ease}
    .notification.success{background:var(--success-gradient)}
    .notification.error{background:var(--danger-gradient)}
    .notification.warning{background:var(--warning-gradient)}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @media(max-width:768px){
      .admin-container{flex-direction:column}
      .sidebar{width:100%;height:auto}
      .main-content{padding:15px}
      .stats-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="https://github.com/s42144/exotix-/blob/ce4cd9399ff673963389c393946138254a0edbe5/USDT-Ton-Wallet.png?raw=true" class="sidebar-logo" alt="Exotix Trade">
        <div class="sidebar-title">Exotix Trade</div>
        <div class="sidebar-subtitle">Admin Panel</div>
      </div>
      
      <nav>
        <a class="nav-item active" data-tab="dashboard">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
          </svg>
          Dashboard
        </a>
        <a class="nav-item" data-tab="users">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
          </svg>
          Users
        </a>
        <a class="nav-item" data-tab="deposits">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
          </svg>
          Deposits
        </a>
        <a class="nav-item" data-tab="withdrawals">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
          </svg>
          Withdrawals
        </a>
        <a class="nav-item" data-tab="tasks">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 100 4h2a2 2 0 100 4h2a1 1 0 100 2 2 2 0 01-2 2H6a2 2 0 01-2-2V5z" clip-rule="evenodd"></path>
          </svg>
          Tasks
        </a>
        <a class="nav-item" data-tab="redeem-codes">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
          </svg>
          Redeem Codes
        </a>
        <a class="nav-item" data-tab="promo-codes">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
          </svg>
          Promo Codes
        </a>
        <a class="nav-item" data-tab="milestones">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
          </svg>
          Milestones
        </a>
        <a class="nav-item" data-tab="announcements">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"></path>
          </svg>
          Announcements
        </a>
        <a class="nav-item" data-tab="balance-adjustment">
          <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
          </svg>
          Balance Adjustment
        </a>
      </nav>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Dashboard Tab -->
      <div class="tab-content active" id="dashboard">
        <div class="content-header">
          <h1 class="content-title">Dashboard</h1>
          <p class="content-subtitle">Overview of your platform statistics</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Users</div>
              <div class="stat-icon" style="background: var(--primary-gradient);">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                </svg>
              </div>
            </div>
            <div class="stat-value" id="totalUsers">0</div>
            <div class="stat-change positive">+12% from last month</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Daily Active Users</div>
              <div class="stat-icon" style="background: var(--success-gradient);">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                </svg>
              </div>
            </div>
            <div class="stat-value" id="dailyActiveUsers">0</div>
            <div class="stat-change positive">+8% from yesterday</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Total Deposits</div>
              <div class="stat-icon" style="background: var(--warning-gradient);">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </div>
            <div class="stat-value" id="totalDeposits">$0</div>
            <div class="stat-change positive">+15% from last month</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Pending Withdrawals</div>
              <div class="stat-icon" style="background: var(--danger-gradient);">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </div>
            <div class="stat-value" id="pendingWithdrawals">$0</div>
            <div class="stat-change negative">+5% from last week</div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">User Activity</h2>
          </div>
          <div class="chart-container">
            <canvas id="userActivityChart"></canvas>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Recent Activities</h2>
          </div>
          <div id="recentActivities"></div>
        </div>
      </div>
      
      <!-- Users Tab -->
      <div class="tab-content" id="users">
        <div class="content-header">
          <h1 class="content-title">Users</h1>
          <p class="content-subtitle">Manage platform users</p>
        </div>
        
        <div class="search-box">
          <input type="text" class="search-input" id="userSearchInput" placeholder="Search by User ID">
          <button class="search-btn" id="userSearchBtn">Search</button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">All Users</h2>
            <button class="btn btn-primary" id="refreshUsersBtn">Refresh</button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Name</th>
                  <th>Balance</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Users will be populated here -->
              </tbody>
            </table>
          </div>
          <div class="pagination" id="usersPagination">
            <!-- Pagination will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- Deposits Tab -->
      <div class="tab-content" id="deposits">
        <div class="content-header">
          <h1 class="content-title">Deposits</h1>
          <p class="content-subtitle">Manage user deposits</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Pending Deposits</h2>
            <button class="btn btn-primary" id="refreshDepositsBtn">Refresh</button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Amount</th>
                  <th>Promo Code</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="depositsTableBody">
                <!-- Deposits will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Withdrawals Tab -->
      <div class="tab-content" id="withdrawals">
        <div class="content-header">
          <h1 class="content-title">Withdrawals</h1>
          <p class="content-subtitle">Manage user withdrawals</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Pending Withdrawals</h2>
            <button class="btn btn-primary" id="refreshWithdrawalsBtn">Refresh</button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Amount</th>
                  <th>Address</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="withdrawalsTableBody">
                <!-- Withdrawals will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Tasks Tab -->
      <div class="tab-content" id="tasks">
        <div class="content-header">
          <h1 class="content-title">Tasks</h1>
          <p class="content-subtitle">Manage user tasks</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Tasks</h2>
            <button class="btn btn-primary" id="addTaskBtn">Add Task</button>
          </div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Reward</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tasksTableBody">
                <!-- Tasks will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Redeem Codes Tab -->
      <div class="tab-content" id="redeem-codes">
        <div class="content-header">
          <h1 class="content-title">Redeem Codes</h1>
          <p class="content-subtitle">Manage redeem codes</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Generate New Code</h2>
          </div>
          <div class="form-group">
            <label class="form-label">Total USDT Pool</label>
            <input type="number" class="form-input" id="redeemPoolAmount" placeholder="Enter amount">
          </div>
          <div class="form-group">
            <label class="form-label">Max Users</label>
            <input type="number" class="form-input" id="redeemMaxUsers" placeholder="Enter max users">
          </div>
          <button class="btn btn-primary" id="generateRedeemCodeBtn">Generate Code</button>
          <div class="code-display" id="generatedRedeemCode" style="display:none;"></div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Existing Codes</h2>
          </div>
          <div class="code-list" id="redeemCodesList">
            <!-- Codes will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- Promo Codes Tab -->
      <div class="tab-content" id="promo-codes">
        <div class="content-header">
          <h1 class="content-title">Promo Codes</h1>
          <p class="content-subtitle">Manage promo codes</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Generate New Code</h2>
          </div>
          <div class="form-group">
            <label class="form-label">Bonus Percentage (%)</label>
            <input type="number" class="form-input" id="promoPercentage" placeholder="Enter percentage">
          </div>
          <div class="form-group">
            <label class="form-label">Max Users</label>
            <input type="number" class="form-input" id="promoMaxUsers" placeholder="Enter max users">
          </div>
          <button class="btn btn-primary" id="generatePromoCodeBtn">Generate Code</button>
          <div class="code-display" id="generatedPromoCode" style="display:none;"></div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Existing Codes</h2>
          </div>
          <div class="code-list" id="promoCodesList">
            <!-- Codes will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- Milestones Tab -->
      <div class="tab-content" id="milestones">
        <div class="content-header">
          <h1 class="content-title">Milestone Rewards</h1>
          <p class="content-subtitle">Manage milestone rewards</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Milestone Settings</h2>
          </div>
          <div class="milestone-form">
            <div class="form-group">
              <label class="form-label">100 Ads Reward (USDT)</label>
              <input type="number" class="form-input" id="milestone100Reward" placeholder="Enter reward">
            </div>
            <div class="form-group">
              <label class="form-label">200 Ads Reward (USDT)</label>
              <input type="number" class="form-input" id="milestone200Reward" placeholder="Enter reward">
            </div>
            <div class="form-group">
              <label class="form-label">500 Ads Reward (USDT)</label>
              <input type="number" class="form-input" id="milestone500Reward" placeholder="Enter reward">
            </div>
            <button class="btn btn-primary" id="saveMilestonesBtn">Save Milestones</button>
          </div>
        </div>
      </div>
      
      <!-- Announcements Tab -->
      <div class="tab-content" id="announcements">
        <div class="content-header">
          <h1 class="content-title">Global Announcements</h1>
          <p class="content-subtitle">Send announcements to all users</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Create Announcement</h2>
          </div>
          <div class="announcement-form">
            <div class="form-group">
              <label class="form-label">Message</label>
              <textarea class="form-input" id="announcementMessage" rows="4" placeholder="Enter announcement message"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Image URL</label>
              <input type="text" class="form-input" id="announcementImageUrl" placeholder="Enter image URL">
              <div class="image-preview" id="announcementImagePreview">
                Image preview will appear here
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Inline Buttons</label>
              <div class="inline-button-form">
                <input type="text" class="form-input" id="buttonText" placeholder="Button text">
                <input type="text" class="form-input" id="buttonUrl" placeholder="Button URL">
                <button class="btn btn-primary" id="addButtonBtn">Add</button>
              </div>
              <div class="inline-button-list" id="inlineButtonsList">
                <!-- Buttons will be listed here -->
              </div>
            </div>
            <button class="btn btn-primary" id="sendAnnouncementBtn">Send Announcement</button>
          </div>
        </div>
      </div>
      
      <!-- Balance Adjustment Tab -->
      <div class="tab-content" id="balance-adjustment">
        <div class="content-header">
          <h1 class="content-title">Balance Adjustment</h1>
          <p class="content-subtitle">Adjust user balances</p>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Find User</h2>
          </div>
          <div class="user-search">
            <input type="text" class="user-search-input" id="balanceSearchInput" placeholder="Enter User ID">
            <button class="user-search-btn" id="balanceSearchBtn">Search</button>
          </div>
          <div id="balanceSearchResult">
            <!-- Search result will appear here -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- User Details Modal -->
  <div class="modal" id="userDetailsModal">
    <div class="modal-content user-details-modal">
      <div class="modal-header">
        <h2 class="modal-title">User Details</h2>
        <button class="modal-close" id="closeUserDetailsModal">×</button>
      </div>
      <div id="userDetailsContent">
        <!-- User details will be populated here -->
      </div>
    </div>
  </div>
  
  <!-- Task Modal -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="taskModalTitle">Add Task</h2>
        <button class="modal-close" id="closeTaskModal">×</button>
      </div>
      <div class="task-form">
        <div class="form-group">
          <label class="form-label">Task Name</label>
          <input type="text" class="form-input" id="taskName" placeholder="Enter task name">
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-input" id="taskCategory">
            <option value="Project">Project</option>
            <option value="Partner">Partner</option>
            <option value="Advertise">Advertise</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Reward (USDT)</label>
          <input type="number" class="form-input" id="taskReward" placeholder="Enter reward amount">
        </div>
        <div class="form-group">
          <label class="form-label">Task Link</label>
          <input type="text" class="form-input" id="taskLink" placeholder="Enter task link">
        </div>
        <div class="form-group">
          <label class="form-label">Task Image URL</label>
          <input type="text" class="form-input" id="taskImageUrl" placeholder="Enter image URL">
          <div class="image-preview" id="taskImagePreview">
            Image preview will appear here
          </div>
        </div>
        <button class="btn btn-primary" id="saveTaskBtn">Save Task</button>
      </div>
    </div>
  </div>
  
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBfR97veh6idxb81mH6N5_Gq8-CpW2D7bE",
      authDomain: "jbhigfi.firebaseapp.com",
      databaseURL: "https://jbhigfi-default-rtdb.firebaseio.com",
      projectId: "jbhigfi",
      storageBucket: "jbhigfi.firebasestorage.app",
      messagingSenderId: "736760492095",
      appId: "1:736760492095:web:47b94412495e21c561c88a",
      measurementId: "G-ZZMHC9RTVT"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    // Bot Token
    const BOT_TOKEN = '8332448822:AAHKhDvougBhBThL6aBl3hGjZbKFGAq7BUs';
    
    // Global variables
    let currentTab = 'dashboard';
    let users = [];
    let deposits = [];
    let withdrawals = [];
    let tasks = [];
    let redeemCodes = [];
    let promoCodes = [];
    let currentPage = 1;
    const itemsPerPage = 10;
    let inlineButtons = [];
    let editingTaskId = null;
    
    // Show notification
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // Send bot message
    function sendBotMessage(chatId, message, inlineButtons = null) {
      const payload = {
        chat_id: chatId,
        text: message,
        parse_mode: 'HTML'
      };
      
      if (inlineButtons && inlineButtons.length > 0) {
        payload.reply_markup = {
          inline_keyboard: [inlineButtons]
        };
      }
      
      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (!data.ok) {
          console.error('Bot message failed:', data);
        }
      })
      .catch(error => {
        console.error('Bot message error:', error);
      });
    }
    
    // Tab navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const tab = item.dataset.tab;
        switchTab(tab);
      });
    });
    
    function switchTab(tab) {
      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.toggle('active', item.dataset.tab === tab);
      });
      
      // Update active tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === tab);
      });
      
      currentTab = tab;
      
      // Load tab-specific data
      switch(tab) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'users':
          loadUsers();
          break;
        case 'deposits':
          loadDeposits();
          break;
        case 'withdrawals':
          loadWithdrawals();
          break;
        case 'tasks':
          loadTasks();
          break;
        case 'redeem-codes':
          loadRedeemCodes();
          break;
        case 'promo-codes':
          loadPromoCodes();
          break;
        case 'milestones':
          loadMilestones();
          break;
        case 'announcements':
          // No specific data to load
          break;
        case 'balance-adjustment':
          // No specific data to load
          break;
      }
    }
    
    // Load dashboard data
    function loadDashboard() {
      // Load total users
      database.ref('users').once('value').then(snapshot => {
        const totalUsers = snapshot.numChildren();
        document.getElementById('totalUsers').textContent = totalUsers;
      });
      
      // Load daily active users (users who have been active in the last 24 hours)
      const oneDayAgo = Math.floor(Date.now() / 1000) - 86400;
      database.ref('users').orderByChild('lastActive').startAfter(oneDayAgo).once('value').then(snapshot => {
        const dailyActiveUsers = snapshot.numChildren();
        document.getElementById('dailyActiveUsers').textContent = dailyActiveUsers;
      });
      
      // Load total deposits
      let totalDeposits = 0;
      database.ref('admin/deposits').once('value').then(snapshot => {
        snapshot.forEach(child => {
          const deposit = child.val();
          if (deposit.status === 'approved') {
            totalDeposits += deposit.amount;
          }
        });
        document.getElementById('totalDeposits').textContent = `$${totalDeposits.toFixed(2)}`;
      });
      
      // Load pending withdrawals
      let pendingWithdrawals = 0;
      database.ref('admin/withdrawals').once('value').then(snapshot => {
        snapshot.forEach(child => {
          const withdrawal = child.val();
          if (withdrawal.status === 'pending') {
            pendingWithdrawals += withdrawal.amount;
          }
        });
        document.getElementById('pendingWithdrawals').textContent = `$${pendingWithdrawals.toFixed(2)}`;
      });
      
      // Load user activity chart
      loadUserActivityChart();
      
      // Load recent activities
      loadRecentActivities();
    }
    
    function loadUserActivityChart() {
      const ctx = document.getElementById('userActivityChart').getContext('2d');
      
      // Get last 7 days
      const labels = [];
      const data = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        labels.push(dateStr);
        
        // Count active users for this day
        const dayStart = new Date(dateStr).getTime() / 1000;
        const dayEnd = dayStart + 86400;
        
        database.ref('users').orderByChild('lastActive').startAt(dayStart).endAt(dayEnd).once('value').then(snapshot => {
          data.push(snapshot.numChildren());
          
          // Create chart when all data is loaded
          if (data.length === 7) {
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Active Users',
                  data: data,
                  backgroundColor: 'rgba(59, 130, 246, 0.2)',
                  borderColor: 'rgba(59, 130, 246, 1)',
                  borderWidth: 2,
                  tension: 0.4,
                  fill: true
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    grid: {
                      color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                      color: 'rgba(255, 255, 255, 0.7)'
                    }
                  },
                  x: {
                    grid: {
                      display: false
                    },
                    ticks: {
                      color: 'rgba(255, 255, 255, 0.7)'
                    }
                  }
                }
              }
            });
          }
        });
      }
    }
    
    function loadRecentActivities() {
      const activitiesContainer = document.getElementById('recentActivities');
      activitiesContainer.innerHTML = '<div class="loading">Loading recent activities...</div>';
      
      // Get recent deposits, withdrawals, and plan purchases
      const activities = [];
      
      // Get recent deposits
      database.ref('admin/deposits').orderByChild('timestamp').limitToLast(5).once('value').then(snapshot => {
        snapshot.forEach(child => {
          const deposit = child.val();
          activities.push({
            type: 'deposit',
            user: deposit.userName,
            userId: deposit.userId,
            amount: deposit.amount,
            status: deposit.status,
            timestamp: deposit.timestamp,
            id: deposit.id
          });
        });
        
        // Get recent withdrawals
        database.ref('admin/withdrawals').orderByChild('timestamp').limitToLast(5).once('value').then(snapshot => {
          snapshot.forEach(child => {
            const withdrawal = child.val();
            activities.push({
              type: 'withdrawal',
              user: withdrawal.userName,
              userId: withdrawal.userId,
              amount: withdrawal.amount,
              status: withdrawal.status,
              timestamp: withdrawal.timestamp,
              id: withdrawal.id
            });
          });
          
          // Sort by timestamp (newest first)
          activities.sort((a, b) => b.timestamp - a.timestamp);
          
          // Display only the 10 most recent
          const recentActivities = activities.slice(0, 10);
          
          if (recentActivities.length === 0) {
            activitiesContainer.innerHTML = '<p>No recent activities</p>';
            return;
          }
          
          let html = '';
          recentActivities.forEach(activity => {
            const date = new Date(activity.timestamp * 1000).toLocaleString();
            const statusClass = activity.status === 'approved' ? 'status-approved' : 
                               activity.status === 'rejected' ? 'status-rejected' : 'status-pending';
            
            html += `
              <div class="activity-item">
                <div class="activity-header">
                  <span class="activity-type">${activity.type === 'deposit' ? 'Deposit' : 'Withdrawal'}</span>
                  <span class="activity-date">${date}</span>
                </div>
                <div class="activity-details">
                  <span class="activity-user">${activity.user} (${activity.userId})</span>
                  <span class="activity-amount">$${activity.amount.toFixed(2)}</span>
                  <span class="status-badge ${statusClass}">${activity.status}</span>
                </div>
              </div>
            `;
          });
          
          activitiesContainer.innerHTML = html;
        });
      });
    }
    
    // Load users
    function loadUsers() {
      const usersTableBody = document.getElementById('usersTableBody');
      usersTableBody.innerHTML = '<tr><td colspan="5" class="loading">Loading users...</td></tr>';
      
      database.ref('users').once('value').then(snapshot => {
        users = [];
        
        snapshot.forEach(child => {
          const user = child.val();
          user.id = child.key;
          users.push(user);
        });
        
        // Sort by balance (highest first)
        users.sort((a, b) => (b.usdtBalance || 0) - (a.usdtBalance || 0));
        
        renderUsersTable();
      });
    }
    
    function renderUsersTable(searchTerm = '') {
      const usersTableBody = document.getElementById('usersTableBody');
      const pagination = document.getElementById('usersPagination');
      
      // Filter users if search term is provided
      let filteredUsers = users;
      if (searchTerm) {
        filteredUsers = users.filter(user => 
          user.id.toLowerCase().includes(searchTerm.toLowerCase())
        );
      }
      
      // Calculate pagination
      const totalPages = Math.ceil(filteredUsers.length / itemsPerPage);
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedUsers = filteredUsers.slice(startIndex, endIndex);
      
      // Render table
      let html = '';
      paginatedUsers.forEach(user => {
        const balance = user.usdtBalance || 0;
        const status = user.banned ? 'Banned' : 'Active';
        const statusClass = user.banned ? 'status-rejected' : 'status-approved';
        
        html += `
          <tr>
            <td>${user.id}</td>
            <td>${user.name || 'Unknown'}</td>
            <td>$${balance.toFixed(6)}</td>
            <td><span class="status-badge ${statusClass}">${status}</span></td>
            <td>
              <div class="action-buttons">
                <button class="action-btn edit" data-user-id="${user.id}">Details</button>
                <button class="action-btn ban" data-user-id="${user.id}">${user.banned ? 'Unban' : 'Ban'}</button>
              </div>
            </td>
          </tr>
        `;
      });
      
      usersTableBody.innerHTML = html;
      
      // Render pagination
      let paginationHtml = '';
      
      // Previous button
      paginationHtml += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} data-page="${currentPage - 1}">Previous</button>`;
      
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        paginationHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
      }
      
      // Next button
      paginationHtml += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} data-page="${currentPage + 1}">Next</button>`;
      
      pagination.innerHTML = paginationHtml;
      
      // Add event listeners
      document.querySelectorAll('.action-btn.edit').forEach(btn => {
        btn.addEventListener('click', () => {
          const userId = btn.dataset.userId;
          showUserDetails(userId);
        });
      });
      
      document.querySelectorAll('.action-btn.ban').forEach(btn => {
        btn.addEventListener('click', () => {
          const userId = btn.dataset.userId;
          toggleUserBan(userId);
        });
      });
      
      document.querySelectorAll('.page-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const page = parseInt(btn.dataset.page);
          if (page && page !== currentPage) {
            currentPage = page;
            renderUsersTable(searchTerm);
          }
        });
      });
    }
    
    // Search users
    document.getElementById('userSearchBtn').addEventListener('click', () => {
      const searchTerm = document.getElementById('userSearchInput').value.trim();
      currentPage = 1; // Reset to first page
      renderUsersTable(searchTerm);
    });
    
    document.getElementById('userSearchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const searchTerm = e.target.value.trim();
        currentPage = 1; // Reset to first page
        renderUsersTable(searchTerm);
      }
    });
    
    // Refresh users
    document.getElementById('refreshUsersBtn').addEventListener('click', () => {
      loadUsers();
    });
    
    // Show user details
    function showUserDetails(userId) {
      const user = users.find(u => u.id === userId);
      if (!user) return;
      
      const modal = document.getElementById('userDetailsModal');
      const content = document.getElementById('userDetailsContent');
      
      // Get user's referral count
      database.ref('users').orderByChild('referredBy').equalTo(userId).once('value').then(snapshot => {
        const referralCount = snapshot.numChildren();
        
        // Get user's deposit and withdrawal history
        let totalDeposits = 0;
        let totalWithdrawals = 0;
        
        database.ref('admin/deposits').orderByChild('userId').equalTo(userId).once('value').then(snapshot => {
          snapshot.forEach(child => {
            const deposit = child.val();
            if (deposit.status === 'approved') {
              totalDeposits += deposit.amount;
            }
          });
          
          database.ref('admin/withdrawals').orderByChild('userId').equalTo(userId).once('value').then(snapshot => {
            snapshot.forEach(child => {
              const withdrawal = child.val();
              if (withdrawal.status === 'approved') {
                totalWithdrawals += withdrawal.amount;
              }
            });
            
            content.innerHTML = `
              <div class="detail-row">
                <div class="detail-label">User ID:</div>
                <div class="detail-value">${user.id}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Name:</div>
                <div class="detail-value">${user.name || 'Unknown'}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Balance:</div>
                <div class="detail-value">$${(user.usdtBalance || 0).toFixed(6)}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Status:</div>
                <div class="detail-value">${user.banned ? 'Banned' : 'Active'}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Referrals:</div>
                <div class="detail-value">${referralCount}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Total Deposits:</div>
                <div class="detail-value">$${totalDeposits.toFixed(2)}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Total Withdrawals:</div>
                <div class="detail-value">$${totalWithdrawals.toFixed(2)}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Registration Date:</div>
                <div class="detail-value">${user.createdAt ? new Date(user.createdAt * 1000).toLocaleString() : 'Unknown'}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Last Active:</div>
                <div class="detail-value">${user.lastActive ? new Date(user.lastActive * 1000).toLocaleString() : 'Unknown'}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">TON Wallet:</div>
                <div class="detail-value">${user.ton || 'Not set'}</div>
              </div>
              <div class="balance-adjustment">
                <select id="balanceAdjustmentType">
                  <option value="add">Add Balance</option>
                  <option value="subtract">Subtract Balance</option>
                </select>
                <input type="number" class="form-input" id="balanceAdjustmentAmount" placeholder="Amount">
                <button class="btn btn-primary" id="adjustBalanceBtn">Adjust</button>
              </div>
            `;
            
            // Add event listener for balance adjustment
            document.getElementById('adjustBalanceBtn').addEventListener('click', () => {
              adjustUserBalance(userId);
            });
            
            modal.style.display = 'flex';
          });
        });
      });
    }
    
    // Close user details modal
    document.getElementById('closeUserDetailsModal').addEventListener('click', () => {
      document.getElementById('userDetailsModal').style.display = 'none';
    });
    
    // Toggle user ban
    function toggleUserBan(userId) {
      const user = users.find(u => u.id === userId);
      if (!user) return;
      
      const newBannedStatus = !user.banned;
      
      database.ref('users/' + userId).update({
        banned: newBannedStatus
      }).then(() => {
        showNotification(`User ${newBannedStatus ? 'banned' : 'unbanned'} successfully`);
        loadUsers(); // Reload users
      }).catch(error => {
        console.error('Error updating user ban status:', error);
        showNotification('Error updating user status', 'error');
      });
    }
    
    // Adjust user balance
    function adjustUserBalance(userId) {
      const type = document.getElementById('balanceAdjustmentType').value;
      const amount = parseFloat(document.getElementById('balanceAdjustmentAmount').value);
      
      if (!amount || amount <= 0) {
        showNotification('Please enter a valid amount', 'error');
        return;
      }
      
      database.ref('users/' + userId).once('value').then(snapshot => {
        const user = snapshot.val();
        if (!user) return;
        
        const currentBalance = user.usdtBalance || 0;
        let newBalance;
        
        if (type === 'add') {
          newBalance = currentBalance + amount;
        } else {
          newBalance = currentBalance - amount;
          if (newBalance < 0) {
            showNotification('Insufficient balance', 'error');
            return;
          }
        }
        
        database.ref('users/' + userId).update({
          usdtBalance: newBalance
        }).then(() => {
          showNotification(`Balance ${type === 'add' ? 'added' : 'subtracted'} successfully`);
          document.getElementById('userDetailsModal').style.display = 'none';
          loadUsers(); // Reload users
        }).catch(error => {
          console.error('Error adjusting user balance:', error);
          showNotification('Error adjusting balance', 'error');
        });
      });
    }
    
    // Load deposits
    function loadDeposits() {
      const depositsTableBody = document.getElementById('depositsTableBody');
      depositsTableBody.innerHTML = '<tr><td colspan="7" class="loading">Loading deposits...</td></tr>';
      
      database.ref('admin/deposits').orderByChild('timestamp').once('value').then(snapshot => {
        deposits = [];
        
        snapshot.forEach(child => {
          const deposit = child.val();
          deposit.id = child.key;
          deposits.push(deposit);
        });
        
        // Sort by timestamp (newest first)
        deposits.sort((a, b) => b.timestamp - a.timestamp);
        
        // Filter only pending deposits
        const pendingDeposits = deposits.filter(d => d.status === 'pending');
        
        if (pendingDeposits.length === 0) {
          depositsTableBody.innerHTML = '<tr><td colspan="7">No pending deposits</td></tr>';
          return;
        }
        
        let html = '';
        pendingDeposits.forEach(deposit => {
          const date = new Date(deposit.timestamp * 1000).toLocaleString();
          
          html += `
            <tr>
              <td>${deposit.id}</td>
              <td>${deposit.userName} (${deposit.userId})</td>
              <td>$${deposit.amount.toFixed(2)}</td>
              <td>${deposit.promoCode || 'None'}</td>
              <td>${date}</td>
              <td><span class="status-badge status-pending">Pending</span></td>
              <td>
                <div class="action-buttons">
                  <button class="action-btn approve" data-deposit-id="${deposit.id}">Approve</button>
                  <button class="action-btn reject" data-deposit-id="${deposit.id}">Reject</button>
                </div>
              </td>
            </tr>
          `;
        });
        
        depositsTableBody.innerHTML = html;
        
        // Add event listeners
        document.querySelectorAll('.action-btn.approve').forEach(btn => {
          btn.addEventListener('click', () => {
            const depositId = btn.dataset.depositId;
            approveDeposit(depositId);
          });
        });
        
        document.querySelectorAll('.action-btn.reject').forEach(btn => {
          btn.addEventListener('click', () => {
            const depositId = btn.dataset.depositId;
            rejectDeposit(depositId);
          });
        });
      });
    }
    
    // Approve deposit
    function approveDeposit(depositId) {
      const deposit = deposits.find(d => d.id === depositId);
      if (!deposit) return;
      
      // Update deposit status
      database.ref('admin/deposits/' + depositId).update({
        status: 'approved'
      }).then(() => {
        // Update user balance
        database.ref('users/' + deposit.userId).once('value').then(snapshot => {
          const user = snapshot.val();
          if (!user) return;
          
          const newBalance = (user.usdtBalance || 0) + deposit.amount;
          
          database.ref('users/' + deposit.userId).update({
            usdtBalance: newBalance
          }).then(() => {
            // Update deposit history in user's data
            if (user.depositHistory) {
              const depositIndex = user.depositHistory.findIndex(d => d.id === depositId);
              if (depositIndex !== -1) {
                user.depositHistory[depositIndex].status = 'approved';
                user.depositHistory[depositIndex].balanceUpdated = true;
                database.ref('users/' + deposit.userId + '/depositHistory').set(user.depositHistory);
              }
            }
            
            // Send notification to user
            sendBotMessage(deposit.userId, `✅ <b>Deposit Approved</b>\nAmount: $${deposit.amount.toFixed(2)} USDT\nNew balance: $${newBalance.toFixed(6)} USDT`);
            
            showNotification('Deposit approved successfully');
            loadDeposits(); // Reload deposits
          });
        });
      }).catch(error => {
        console.error('Error approving deposit:', error);
        showNotification('Error approving deposit', 'error');
      });
    }
    
    // Reject deposit
    function rejectDeposit(depositId) {
      const deposit = deposits.find(d => d.id === depositId);
      if (!deposit) return;
      
      const reason = prompt('Please enter rejection reason:');
      if (!reason) return;
      
      // Update deposit status
      database.ref('admin/deposits/' + depositId).update({
        status: 'rejected',
        reason: reason
      }).then(() => {
        // Update deposit history in user's data
        database.ref('users/' + deposit.userId).once('value').then(snapshot => {
          const user = snapshot.val();
          if (!user) return;
          
          if (user.depositHistory) {
            const depositIndex = user.depositHistory.findIndex(d => d.id === depositId);
            if (depositIndex !== -1) {
              user.depositHistory[depositIndex].status = 'rejected';
              database.ref('users/' + deposit.userId + '/depositHistory').set(user.depositHistory);
            }
          }
          
          // Send notification to user
          sendBotMessage(deposit.userId, `❌ <b>Deposit Rejected</b>\nAmount: $${deposit.amount.toFixed(2)} USDT\nReason: ${reason}`);
          
          showNotification('Deposit rejected successfully');
          loadDeposits(); // Reload deposits
        });
      }).catch(error => {
        console.error('Error rejecting deposit:', error);
        showNotification('Error rejecting deposit', 'error');
      });
    }
    
    // Refresh deposits
    document.getElementById('refreshDepositsBtn').addEventListener('click', () => {
      loadDeposits();
    });
    
    // Load withdrawals
    function loadWithdrawals() {
      const withdrawalsTableBody = document.getElementById('withdrawalsTableBody');
      withdrawalsTableBody.innerHTML = '<tr><td colspan="7" class="loading">Loading withdrawals...</td></tr>';
      
      database.ref('admin/withdrawals').orderByChild('timestamp').once('value').then(snapshot => {
        withdrawals = [];
        
        snapshot.forEach(child => {
          const withdrawal = child.val();
          withdrawal.id = child.key;
          withdrawals.push(withdrawal);
        });
        
        // Sort by timestamp (newest first)
        withdrawals.sort((a, b) => b.timestamp - a.timestamp);
        
        // Filter only pending withdrawals
        const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
        
        if (pendingWithdrawals.length === 0) {
          withdrawalsTableBody.innerHTML = '<tr><td colspan="7">No pending withdrawals</td></tr>';
          return;
        }
        
        let html = '';
        pendingWithdrawals.forEach(withdrawal => {
          const date = new Date(withdrawal.timestamp * 1000).toLocaleString();
          
          html += `
            <tr>
              <td>${withdrawal.id}</td>
              <td>${withdrawal.userName} (${withdrawal.userId})</td>
              <td>$${withdrawal.amount.toFixed(2)}</td>
              <td>${withdrawal.address}</td>
              <td>${date}</td>
              <td><span class="status-badge status-pending">Pending</span></td>
              <td>
                <div class="action-buttons">
                  <button class="action-btn approve" data-withdrawal-id="${withdrawal.id}">Approve</button>
                  <button class="action-btn reject" data-withdrawal-id="${withdrawal.id}">Reject</button>
                </div>
              </td>
            </tr>
          `;
        });
        
        withdrawalsTableBody.innerHTML = html;
        
        // Add event listeners
        document.querySelectorAll('.action-btn.approve').forEach(btn => {
          btn.addEventListener('click', () => {
            const withdrawalId = btn.dataset.withdrawalId;
            approveWithdrawal(withdrawalId);
          });
        });
        
        document.querySelectorAll('.action-btn.reject').forEach(btn => {
          btn.addEventListener('click', () => {
            const withdrawalId = btn.dataset.withdrawalId;
            rejectWithdrawal(withdrawalId);
          });
        });
      });
    }
    
    // Approve withdrawal
    function approveWithdrawal(withdrawalId) {
      const withdrawal = withdrawals.find(w => w.id === withdrawalId);
      if (!withdrawal) return;
      
      // Update withdrawal status
      database.ref('admin/withdrawals/' + withdrawalId).update({
        status: 'approved'
      }).then(() => {
        // Update withdrawal history in user's data
        database.ref('users/' + withdrawal.userId).once('value').then(snapshot => {
          const user = snapshot.val();
          if (!user) return;
          
          if (user.withdrawHistory) {
            const withdrawalIndex = user.withdrawHistory.findIndex(w => w.id === withdrawalId);
            if (withdrawalIndex !== -1) {
              user.withdrawHistory[withdrawalIndex].status = 'approved';
              user.withdrawHistory[withdrawalIndex].balanceUpdated = true;
              database.ref('users/' + withdrawal.userId + '/withdrawHistory').set(user.withdrawHistory);
            }
          }
          
          // Send notification to user
          sendBotMessage(withdrawal.userId, `✅ <b>Withdrawal Approved</b>\nAmount: $${withdrawal.amount.toFixed(2)} USDT`);
          
          showNotification('Withdrawal approved successfully');
          loadWithdrawals(); // Reload withdrawals
        });
      }).catch(error => {
        console.error('Error approving withdrawal:', error);
        showNotification('Error approving withdrawal', 'error');
      });
    }
    
    // Reject withdrawal
    function rejectWithdrawal(withdrawalId) {
      const withdrawal = withdrawals.find(w => w.id === withdrawalId);
      if (!withdrawal) return;
      
      const reason = prompt('Please enter rejection reason:');
      if (!reason) return;
      
      // Update withdrawal status
      database.ref('admin/withdrawals/' + withdrawalId).update({
        status: 'rejected',
        reason: reason
      }).then(() => {
        // Refund amount to user balance
        database.ref('users/' + withdrawal.userId).once('value').then(snapshot => {
          const user = snapshot.val();
          if (!user) return;
          
          const newBalance = (user.usdtBalance || 0) + withdrawal.amount;
          
          database.ref('users/' + withdrawal.userId).update({
            usdtBalance: newBalance
          }).then(() => {
            // Update withdrawal history in user's data
            if (user.withdrawHistory) {
              const withdrawalIndex = user.withdrawHistory.findIndex(w => w.id === withdrawalId);
              if (withdrawalIndex !== -1) {
                user.withdrawHistory[withdrawalIndex].status = 'rejected';
                user.withdrawHistory[withdrawalIndex].balanceUpdated = true;
                database.ref('users/' + withdrawal.userId + '/withdrawHistory').set(user.withdrawHistory);
              }
            }
            
            // Send notification to user
            sendBotMessage(withdrawal.userId, `❌ <b>Withdrawal Rejected</b>\nAmount: $${withdrawal.amount.toFixed(2)} USDT\nReason: ${reason}\nAmount refunded to balance`);
            
            showNotification('Withdrawal rejected successfully');
            loadWithdrawals(); // Reload withdrawals
          });
        });
      }).catch(error => {
        console.error('Error rejecting withdrawal:', error);
        showNotification('Error rejecting withdrawal', 'error');
      });
    }
    
    // Refresh withdrawals
    document.getElementById('refreshWithdrawalsBtn').addEventListener('click', () => {
      loadWithdrawals();
    });
    
    // Load tasks
    function loadTasks() {
      const tasksTableBody = document.getElementById('tasksTableBody');
      tasksTableBody.innerHTML = '<tr><td colspan="5" class="loading">Loading tasks...</td></tr>';
      
      database.ref('tasks').once('value').then(snapshot => {
        tasks = [];
        
        snapshot.forEach(child => {
          const task = child.val();
          task.id = child.key;
          tasks.push(task);
        });
        
        if (tasks.length === 0) {
          tasksTableBody.innerHTML = '<tr><td colspan="5">No tasks found</td></tr>';
          return;
        }
        
        let html = '';
        tasks.forEach(task => {
          html += `
            <tr>
              <td>${task.name}</td>
              <td>${task.category}</td>
              <td>$${task.amount} USDT</td>
              <td><span class="status-badge status-approved">Active</span></td>
              <td>
                <div class="action-buttons">
                  <button class="action-btn edit" data-task-id="${task.id}">Edit</button>
                  <button class="action-btn delete" data-task-id="${task.id}">Delete</button>
                </div>
              </td>
            </tr>
          `;
        });
        
        tasksTableBody.innerHTML = html;
        
        // Add event listeners
        document.querySelectorAll('.action-btn.edit').forEach(btn => {
          btn.addEventListener('click', () => {
            const taskId = btn.dataset.taskId;
            editTask(taskId);
          });
        });
        
        document.querySelectorAll('.action-btn.delete').forEach(btn => {
          btn.addEventListener('click', () => {
            const taskId = btn.dataset.taskId;
            deleteTask(taskId);
          });
        });
      });
    }
    
    // Add task button
    document.getElementById('addTaskBtn').addEventListener('click', () => {
      editingTaskId = null;
      document.getElementById('taskModalTitle').textContent = 'Add Task';
      document.getElementById('taskName').value = '';
      document.getElementById('taskCategory').value = 'Project';
      document.getElementById('taskReward').value = '';
      document.getElementById('taskLink').value = '';
      document.getElementById('taskImageUrl').value = '';
      document.getElementById('taskImagePreview').innerHTML = 'Image preview will appear here';
      document.getElementById('taskModal').style.display = 'flex';
    });
    
    // Edit task
    function editTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;
      
      editingTaskId = taskId;
      document.getElementById('taskModalTitle').textContent = 'Edit Task';
      document.getElementById('taskName').value = task.name;
      document.getElementById('taskCategory').value = task.category;
      document.getElementById('taskReward').value = task.amount;
      document.getElementById('taskLink').value = task.link;
      document.getElementById('taskImageUrl').value = task.photo;
      
      // Show image preview
      if (task.photo) {
        document.getElementById('taskImagePreview').innerHTML = `<img src="${task.photo}" alt="Task Image">`;
      } else {
        document.getElementById('taskImagePreview').innerHTML = 'Image preview will appear here';
      }
      
      document.getElementById('taskModal').style.display = 'flex';
    }
    
    // Delete task
    function deleteTask(taskId) {
      if (!confirm('Are you sure you want to delete this task?')) return;
      
      database.ref('tasks/' + taskId).remove().then(() => {
        showNotification('Task deleted successfully');
        loadTasks(); // Reload tasks
      }).catch(error => {
        console.error('Error deleting task:', error);
        showNotification('Error deleting task', 'error');
      });
    }
    
    // Close task modal
    document.getElementById('closeTaskModal').addEventListener('click', () => {
      document.getElementById('taskModal').style.display = 'none';
    });
    
    // Save task
    document.getElementById('saveTaskBtn').addEventListener('click', () => {
      const name = document.getElementById('taskName').value.trim();
      const category = document.getElementById('taskCategory').value;
      const reward = document.getElementById('taskReward').value.trim();
      const link = document.getElementById('taskLink').value.trim();
      const imageUrl = document.getElementById('taskImageUrl').value.trim();
      
      if (!name || !reward || !link) {
        showNotification('Please fill all required fields', 'error');
        return;
      }
      
      const taskData = {
        name: name,
        category: category,
        amount: parseFloat(reward),
        link: link,
        photo: imageUrl
      };
      
      if (editingTaskId) {
        // Update existing task
        database.ref('tasks/' + editingTaskId).update(taskData).then(() => {
          showNotification('Task updated successfully');
          document.getElementById('taskModal').style.display = 'none';
          loadTasks(); // Reload tasks
        }).catch(error => {
          console.error('Error updating task:', error);
          showNotification('Error updating task', 'error');
        });
      } else {
        // Add new task
        database.ref('tasks').push(taskData).then(() => {
          showNotification('Task added successfully');
          document.getElementById('taskModal').style.display = 'none';
          loadTasks(); // Reload tasks
        }).catch(error => {
          console.error('Error adding task:', error);
          showNotification('Error adding task', 'error');
        });
      }
    });
    
    // Task image preview
    document.getElementById('taskImageUrl').addEventListener('input', (e) => {
      const imageUrl = e.target.value.trim();
      const preview = document.getElementById('taskImagePreview');
      
      if (imageUrl) {
        preview.innerHTML = `<img src="${imageUrl}" alt="Task Image" onerror="this.parentElement.innerHTML='Invalid image URL'">`;
      } else {
        preview.innerHTML = 'Image preview will appear here';
      }
    });
    
    // Announcement image preview
    document.getElementById('announcementImageUrl').addEventListener('input', (e) => {
      const imageUrl = e.target.value.trim();
      const preview = document.getElementById('announcementImagePreview');
      
      if (imageUrl) {
        preview.innerHTML = `<img src="${imageUrl}" alt="Announcement Image" onerror="this.parentElement.innerHTML='Invalid image URL'">`;
      } else {
        preview.innerHTML = 'Image preview will appear here';
      }
    });
    
    // Load redeem codes
    function loadRedeemCodes() {
      database.ref('redeemCodes').once('value').then(snapshot => {
        redeemCodes = [];
        
        snapshot.forEach(child => {
          const code = child.val();
          code.id = child.key;
          redeemCodes.push(code);
        });
        
        renderRedeemCodes();
      });
    }
    
    function renderRedeemCodes() {
      const codesList = document.getElementById('redeemCodesList');
      
      if (redeemCodes.length === 0) {
        codesList.innerHTML = '<p>No redeem codes found</p>';
        return;
      }
      
      let html = '';
      redeemCodes.forEach(code => {
        html += `
          <div class="code-item">
            <div class="code-info">
              <div class="code-value">${code.id}</div>
              <div class="code-details">Pool: $${code.pool} USDT | Used: ${code.used}/${code.maxUsers}</div>
            </div>
            <div class="code-actions">
              <button class="copy-btn" data-code="${code.id}">Copy</button>
              <button class="delete-btn" data-code-id="${code.id}">Delete</button>
            </div>
          </div>
        `;
      });
      
      codesList.innerHTML = html;
      
      // Add event listeners
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const code = btn.dataset.code;
          navigator.clipboard.writeText(code).then(() => {
            showNotification('Code copied to clipboard');
          });
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const codeId = btn.dataset.codeId;
          deleteRedeemCode(codeId);
        });
      });
    }
    
    // Generate redeem code
    document.getElementById('generateRedeemCodeBtn').addEventListener('click', () => {
      const poolAmount = parseFloat(document.getElementById('redeemPoolAmount').value);
      const maxUsers = parseInt(document.getElementById('redeemMaxUsers').value);
      
      if (!poolAmount || !maxUsers) {
        showNotification('Please fill all fields', 'error');
        return;
      }
      
      // Generate random 8-character code
      const code = Math.random().toString(36).substring(2, 10).toUpperCase();
      
      // Save to database
      database.ref('redeemCodes/' + code).set({
        pool: poolAmount,
        maxUsers: maxUsers,
        used: 0
      }).then(() => {
        // Display generated code
        document.getElementById('generatedRedeemCode').textContent = code;
        document.getElementById('generatedRedeemCode').style.display = 'block';
        
        // Clear form
        document.getElementById('redeemPoolAmount').value = '';
        document.getElementById('redeemMaxUsers').value = '';
        
        showNotification('Redeem code generated successfully');
        loadRedeemCodes(); // Reload codes
      }).catch(error => {
        console.error('Error generating redeem code:', error);
        showNotification('Error generating redeem code', 'error');
      });
    });
    
    // Delete redeem code
    function deleteRedeemCode(codeId) {
      if (!confirm('Are you sure you want to delete this redeem code?')) return;
      
      database.ref('redeemCodes/' + codeId).remove().then(() => {
        showNotification('Redeem code deleted successfully');
        loadRedeemCodes(); // Reload codes
      }).catch(error => {
        console.error('Error deleting redeem code:', error);
        showNotification('Error deleting redeem code', 'error');
      });
    }
    
    // Load promo codes
    function loadPromoCodes() {
      database.ref('promoCodes').once('value').then(snapshot => {
        promoCodes = [];
        
        snapshot.forEach(child => {
          const code = child.val();
          code.id = child.key;
          promoCodes.push(code);
        });
        
        renderPromoCodes();
      });
    }
    
    function renderPromoCodes() {
      const codesList = document.getElementById('promoCodesList');
      
      if (promoCodes.length === 0) {
        codesList.innerHTML = '<p>No promo codes found</p>';
        return;
      }
      
      let html = '';
      promoCodes.forEach(code => {
        html += `
          <div class="code-item">
            <div class="code-info">
              <div class="code-value">${code.id}</div>
              <div class="code-details">Bonus: ${code.percentage}% | Used: ${code.used}/${code.maxUsers}</div>
            </div>
            <div class="code-actions">
              <button class="copy-btn" data-code="${code.id}">Copy</button>
              <button class="delete-btn" data-code-id="${code.id}">Delete</button>
            </div>
          </div>
        `;
      });
      
      codesList.innerHTML = html;
      
      // Add event listeners
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const code = btn.dataset.code;
          navigator.clipboard.writeText(code).then(() => {
            showNotification('Code copied to clipboard');
          });
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const codeId = btn.dataset.codeId;
          deletePromoCode(codeId);
        });
      });
    }
    
    // Generate promo code
    document.getElementById('generatePromoCodeBtn').addEventListener('click', () => {
      const percentage = parseFloat(document.getElementById('promoPercentage').value);
      const maxUsers = parseInt(document.getElementById('promoMaxUsers').value);
      
      if (!percentage || !maxUsers) {
        showNotification('Please fill all fields', 'error');
        return;
      }
      
      // Generate random 8-character code
      const code = Math.random().toString(36).substring(2, 10).toUpperCase();
      
      // Save to database
      database.ref('promoCodes/' + code).set({
        percentage: percentage,
        maxUsers: maxUsers,
        used: 0
      }).then(() => {
        // Display generated code
        document.getElementById('generatedPromoCode').textContent = code;
        document.getElementById('generatedPromoCode').style.display = 'block';
        
        // Clear form
        document.getElementById('promoPercentage').value = '';
        document.getElementById('promoMaxUsers').value = '';
        
        showNotification('Promo code generated successfully');
        loadPromoCodes(); // Reload codes
      }).catch(error => {
        console.error('Error generating promo code:', error);
        showNotification('Error generating promo code', 'error');
      });
    });
    
    // Delete promo code
    function deletePromoCode(codeId) {
      if (!confirm('Are you sure you want to delete this promo code?')) return;
      
      database.ref('promoCodes/' + codeId).remove().then(() => {
        showNotification('Promo code deleted successfully');
        loadPromoCodes(); // Reload codes
      }).catch(error => {
        console.error('Error deleting promo code:', error);
        showNotification('Error deleting promo code', 'error');
      });
    }
    
    // Load milestones
    function loadMilestones() {
      database.ref('milestones').once('value').then(snapshot => {
        const milestones = snapshot.val() || {};
        
        document.getElementById('milestone100Reward').value = milestones.milestone100 || 0.00213;
        document.getElementById('milestone200Reward').value = milestones.milestone200 || 0.016;
        document.getElementById('milestone500Reward').value = milestones.milestone500 || 0.0213;
      });
    }
    
    // Save milestones
    document.getElementById('saveMilestonesBtn').addEventListener('click', () => {
      const milestone100 = parseFloat(document.getElementById('milestone100Reward').value);
      const milestone200 = parseFloat(document.getElementById('milestone200Reward').value);
      const milestone500 = parseFloat(document.getElementById('milestone500Reward').value);
      
      if (!milestone100 || !milestone200 || !milestone500) {
        showNotification('Please fill all fields', 'error');
        return;
      }
      
      database.ref('milestones').set({
        milestone100: milestone100,
        milestone200: milestone200,
        milestone500: milestone500
      }).then(() => {
        showNotification('Milestones saved successfully');
      }).catch(error => {
        console.error('Error saving milestones:', error);
        showNotification('Error saving milestones', 'error');
      });
    });
    
    // Add inline button
    document.getElementById('addButtonBtn').addEventListener('click', () => {
      const buttonText = document.getElementById('buttonText').value.trim();
      const buttonUrl = document.getElementById('buttonUrl').value.trim();
      
      if (!buttonText || !buttonUrl) {
        showNotification('Please fill both button text and URL', 'error');
        return;
      }
      
      inlineButtons.push({ text: buttonText, url: buttonUrl });
      
      // Update buttons list
      const buttonsList = document.getElementById('inlineButtonsList');
      let html = '';
      
      inlineButtons.forEach((button, index) => {
        html += `
          <div class="inline-button-item">
            <span>${button.text}: ${button.url}</span>
            <button data-index="${index}">Remove</button>
          </div>
        `;
      });
      
      buttonsList.innerHTML = html;
      
      // Add event listeners to remove buttons
      buttonsList.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.dataset.index);
          inlineButtons.splice(index, 1);
          
          // Re-render buttons list
          let newHtml = '';
          inlineButtons.forEach((button, i) => {
            newHtml += `
              <div class="inline-button-item">
                <span>${button.text}: ${button.url}</span>
                <button data-index="${i}">Remove</button>
              </div>
            `;
          });
          
          buttonsList.innerHTML = newHtml;
          
          // Re-add event listeners
          buttonsList.querySelectorAll('button').forEach(newBtn => {
            newBtn.addEventListener('click', () => {
              const idx = parseInt(newBtn.dataset.index);
              inlineButtons.splice(idx, 1);
              
              // Re-render buttons list
              let html = '';
              inlineButtons.forEach((button, j) => {
                html += `
                  <div class="inline-button-item">
                    <span>${button.text}: ${button.url}</span>
                    <button data-index="${j}">Remove</button>
                  </div>
                `;
              });
              
              buttonsList.innerHTML = html;
              
              // Re-add event listeners
              buttonsList.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                  const idx = parseInt(btn.dataset.index);
                  inlineButtons.splice(idx, 1);
                  
                  // Re-render buttons list
                  let html = '';
                  inlineButtons.forEach((button, k) => {
                    html += `
                      <div class="inline-button-item">
                        <span>${button.text}: ${button.url}</span>
                        <button data-index="${k}">Remove</button>
                      </div>
                    `;
                  });
                  
                  buttonsList.innerHTML = html;
                  
                  // Re-add event listeners
                  buttonsList.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('click', () => {
                      const idx = parseInt(btn.dataset.index);
                      inlineButtons.splice(idx, 1);
                      
                      // Re-render buttons list
                      let html = '';
                      inlineButtons.forEach((button, l) => {
                        html += `
                          <div class="inline-button-item">
                            <span>${button.text}: ${button.url}</span>
                            <button data-index="${l}">Remove</button>
                          </div>
                        `;
                      });
                      
                      buttonsList.innerHTML = html;
                    });
                  });
                });
              });
            });
          });
        });
      });
      
      // Clear form
      document.getElementById('buttonText').value = '';
      document.getElementById('buttonUrl').value = '';
    });
    
    // Send announcement
    document.getElementById('sendAnnouncementBtn').addEventListener('click', () => {
      const message = document.getElementById('announcementMessage').value.trim();
      const imageUrl = document.getElementById('announcementImageUrl').value.trim();
      
      if (!message) {
        showNotification('Please enter announcement message', 'error');
        return;
      }
      
      // Get all users
      database.ref('users').once('value').then(snapshot => {
        const users = [];
        
        snapshot.forEach(child => {
          const user = child.val();
          users.push(user.id);
        });
        
        // Send announcement to all users
        users.forEach(userId => {
          sendBotMessage(userId, message, inlineButtons);
        });
        
        // Log announcement
        database.ref('admin/announcements').push({
          message: message,
          imageUrl: imageUrl,
          buttons: inlineButtons,
          timestamp: Math.floor(Date.now() / 1000)
        });
        
        showNotification('Announcement sent successfully');
        
        // Clear form
        document.getElementById('announcementMessage').value = '';
        document.getElementById('announcementImageUrl').value = '';
        document.getElementById('announcementImagePreview').innerHTML = 'Image preview will appear here';
        document.getElementById('inlineButtonsList').innerHTML = '';
        inlineButtons = [];
      });
    });
    
    // Search user for balance adjustment
    document.getElementById('balanceSearchBtn').addEventListener('click', () => {
      const userId = document.getElementById('balanceSearchInput').value.trim();
      
      if (!userId) {
        showNotification('Please enter a User ID', 'error');
        return;
      }
      
      database.ref('users/' + userId).once('value').then(snapshot => {
        const user = snapshot.val();
        
        if (!user) {
          document.getElementById('balanceSearchResult').innerHTML = '<p>User not found</p>';
          return;
        }
        
        document.getElementById('balanceSearchResult').innerHTML = `
          <div class="user-result">
            <div class="user-result-name">${user.name || 'Unknown'}</div>
            <div class="user-result-id">ID: ${userId}</div>
            <div class="user-result-balance">Balance: $${(user.usdtBalance || 0).toFixed(6)}</div>
            <div class="balance-adjustment">
              <select id="balanceAdjustmentType">
                <option value="add">Add Balance</option>
                <option value="subtract">Subtract Balance</option>
              </select>
              <input type="number" class="form-input" id="balanceAdjustmentAmount" placeholder="Amount">
              <button class="btn btn-primary" id="adjustBalanceBtn">Adjust</button>
            </div>
          </div>
        `;
        
        // Add event listener for balance adjustment
        document.getElementById('adjustBalanceBtn').addEventListener('click', () => {
          adjustUserBalance(userId);
        });
      });
    });
    
    document.getElementById('balanceSearchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const userId = e.target.value.trim();
        
        if (!userId) {
          showNotification('Please enter a User ID', 'error');
          return;
        }
        
        database.ref('users/' + userId).once('value').then(snapshot => {
          const user = snapshot.val();
          
          if (!user) {
            document.getElementById('balanceSearchResult').innerHTML = '<p>User not found</p>';
            return;
          }
          
          document.getElementById('balanceSearchResult').innerHTML = `
            <div class="user-result">
              <div class="user-result-name">${user.name || 'Unknown'}</div>
              <div class="user-result-id">ID: ${userId}</div>
              <div class="user-result-balance">Balance: $${(user.usdtBalance || 0).toFixed(6)}</div>
              <div class="balance-adjustment">
                <select id="balanceAdjustmentType">
                  <option value="add">Add Balance</option>
                  <option value="subtract">Subtract Balance</option>
                </select>
                <input type="number" class="form-input" id="balanceAdjustmentAmount" placeholder="Amount">
                <button class="btn btn-primary" id="adjustBalanceBtn">Adjust</button>
              </div>
            </div>
          `;
          
          // Add event listener for balance adjustment
          document.getElementById('adjustBalanceBtn').addEventListener('click', () => {
            adjustUserBalance(userId);
          });
        });
      }
    });
    
    // Initialize dashboard on load
    window.addEventListener('load', () => {
      loadDashboard();
    });
  </script>
</body>
</html>
